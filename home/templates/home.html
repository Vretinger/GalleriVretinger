{% extends "base.html" %}
{% load static i18n %}

{% block content %}

<!-- Hero Section -->
<section class="hero-section text-center py-5">
  <div class="container">
    <h1 class="hero-title display-3 fw-bold">{% trans "Welcome to Vretinger Gallery" %}</h1>
    <p class="hero-subtitle lead">{% trans "A creative home for artists, workshops, and events." %}</p>
  </div>
</section>

<!-- Intro Section -->
<section class="intro-section py-5 bg-teal text-dark">
  <div class="container d-flex flex-column flex-md-row align-items-center">
    <div class="intro-image col-md-6 mb-4 mb-md-0">
      <img src="{% static 'images/portrait.jpg' %}" alt="{% trans 'Gallery Interior' %}" class="img-fluid rounded shadow">
    </div>
    <div class="intro-text col-md-6 px-3">
      <h2 class="intro-title">{% trans "More than a gallery — a space for expression" %}</h2>
      <p class="intro-description">
        {% blocktrans %}
          Vretinger Gallery is located in the heart of central Stockholm, 
          a stone's throw from the central station, Drottninggatan, Norra Bantorget, Hotell Generator and Scalateatern. 
          Just opposite you will also find two popular restaurants. 
          Wallingatan is well-trafficked by residents, tourists and people whose work is in the surrounding areas. 
          There is parking for electric cars next to the sidewalk right outside the gallery. 
          <br><br>
          The gallery itself gives a harmonious and cozy impression, is located at street level, has two large storefronts with deep window sills." 
        {% endblocktrans %}
      </p>
    </div>
  </div>
</section>

<!-- Current Event Section -->
<section class="current-event-section py-5">
  <div class="container">
    {% if current_event %}
    <div class="current-event-hero">
      <div class="bg-preview" style="background-image: url('{{ current_event.bg_image.url }}');"></div>

      <div class="overlay-content d-flex flex-column justify-content-center align-items-center text-center text-white">
        <div class="text-background p-4 rounded" style="background-color: rgba(0,0,0,0.6); max-width: 800px;">
          <h1 class="gallery-title">{{ current_event.title }}</h1>
          <p class="gallery-description">{{ current_event.description }}</p>
          {% if event.is_drop_in %}
            <p class="text-success"><strong>Drop-in Event:</strong> No sign-up needed! Come by anytime.</p>
          {% else %}
            <a href="{% url 'book_event' current_event.id %}" class="btn btn-primary">Book a Spot</a>
          {% endif %}

          {% if grouped_days %}
          <h4>{% trans "Event Schedule:" %}</h4>
          <ul class="list-unstyled">
            {% for group in grouped_days %}
              {% if group|length == 1 %}
                <li>{{ group.0.date }}: {{ group.0.start_time|time:"H:i" }} – {{ group.0.end_time|time:"H:i" }}</li>
              {% else %}
                {% with last_day=group|last %}
                <li>{{ group.0.date }} → {{ last_day.date }}: {{ group.0.start_time|time:"H:i" }} – {{ group.0.end_time|time:"H:i" }}</li>
                {% endwith %}
              {% endif %}
            {% endfor %}
          </ul>
          {% endif %}
        </div>

        {% if current_event.images.all %}
        <div class="artwork-grid d-flex flex-wrap gap-2 justify-content-center mt-4">
          {% for img in current_event.images.all %}
          <div class="artwork-item" style="flex: 0 0 150px;">
            <img src="{{ img.image.url }}" alt="{{ current_event.title }}" style="width:100%; border-radius:6px; box-shadow:0 2px 5px rgba(0,0,0,0.2);">
          </div>
          {% endfor %}
        </div>
        {% endif %}
      </div>
    </div>

    {% else %}
    <section class="gallery-showcase">
      <div class="background-image"></div>
      <div class="overlay-content container text-center">
        <h1 class="gallery-title">{% trans "Welcome to Vretinger Gallery" %}</h1>
        <p class="gallery-description">
          {% trans "Experience the warmth and creativity of our gallery space, filled with inspiring artworks from our featured artist." %}
        </p>
      </div>

      <div class="artwork-grid container">
        <div class="artwork-item">
          <img src="{% static 'images/Lemons.jpg' %}" alt="{% trans 'Lemons' %}" />
          <p class="artwork-title">{% trans "Lemons" %}</p>
        </div>
        <div class="artwork-item">
          <img src="{% static 'images/ColorsStrpes.jpg' %}" alt="{% trans 'Colors And Stripes' %}" />
          <p class="artwork-title">{% trans "Colors And Stripes" %}</p>
        </div>
        <div class="artwork-item">
          <img src="{% static 'images/Lion.jpg' %}" alt="{% trans 'Lion' %}" />
          <p class="artwork-title">{% trans "Lion" %}</p>
        </div>
      </div>
    </section>
    {% endif %}
  </div>
</section>

<!-- Upcoming Events Section -->
<section class="upcoming-events-section py-5">
  <div class="container">
    <h2 class="section-heading text-center mb-5">{% trans "Upcoming Events" %}</h2>

    {% if upcoming_events %}
    <div id="upcomingEventsCarousel" class="carousel slide carousel-fade position-relative" data-bs-ride="carousel">

      <div class="carousel-inner">
        {% for event in upcoming_events %}
        <div class="carousel-item {% if forloop.first %}active{% endif %}">
          <div class="event-banner d-flex align-items-center justify-content-center p-4 rounded shadow-sm bg-white" style="max-width:700px; margin:0 auto;">

            {% if event.image %}
            <div class="event-banner-image flex-shrink-0 me-4">
              <img src="{{ event.image.url }}" alt="{{ event.title }}" class="img-fluid rounded" style="max-height:200px; object-fit:cover;">
            </div>
            {% endif %}

            <div class="event-banner-info col-8 text-center text-md-start">
              <h4 class="mb-2">{{ event.title }}</h4>
              <p class="text-muted mb-2">{{ event.description|truncatewords:20 }}</p>
              {% if event.is_drop_in %}
                <p class="text-success"><strong>Drop-in Event:</strong> No sign-up needed! Come by anytime.</p>
              {% else %}
                <a href="{% url 'book_event' event.id %}" class="btn btn-primary">Book a Spot</a>
              {% endif %}
              {% if event.days.exists %}
              <div class="text-gray-600 mb-2">
                {% for day in event.days.all %}
                <p>
                  {% trans "Date" %}: {{ day.date|date:"M d, Y" }} | {% trans "Start" %}: {{ day.start_time|time:"H:i" }} | {% trans "End" %}: {{ day.end_time|time:"H:i" }}
                </p>
                {% empty %}
                <p>{% trans "No EventDays found for this event." %}</p>
                {% endfor %}
              </div>
              {% else %}
              <p>{% trans "No EventDays related to this event." %}</p>
              {% endif %}
            </div>

          </div>
        </div>
        {% endfor %}
      </div>

      {% if upcoming_events|length > 1 %}
      <button class="carousel-control-prev" type="button" data-bs-target="#upcomingEventsCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">{% trans "Previous" %}</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#upcomingEventsCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">{% trans "Next" %}</span>
      </button>
      {% endif %}
    </div>
    {% else %}
    <p class="text-center no-upcoming-events-message">{% trans "No upcoming events yet. Stay tuned!" %}</p>
    {% endif %}

  </div>
</section>

{% endblock %}
