{% load static %}
<!DOCTYPE html>
<html>
<head>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/main.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/main.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container py-4">

  <h2>Select advertised event period</h2>
  <p>You can only select dates within your rental period: <b>{{ request.GET.rental_start }}</b> â†’ <b>{{ request.GET.rental_end }}</b></p>

  <div id="event-calendar" class="mb-4"></div>

  <form action="{% url 'final_booking_submit' %}" method="post" enctype="multipart/form-data" class="row g-3">
      {% csrf_token %}
      
      <!-- hidden fields -->
      <input type="hidden" name="rental_start" value="{{ request.GET.rental_start }}">
      <input type="hidden" name="rental_end" value="{{ request.GET.rental_end }}">
      <input type="hidden" id="event_start" name="event_start">
      <input type="hidden" id="event_end" name="event_end">

      <div class="col-md-6">
        <label class="form-label">Title</label>
        <input type="text" name="title" class="form-control" required>
      </div>

      <div class="col-md-6">
        <label class="form-label">Layout</label>
        <select name="layout" class="form-select">
          {% for value, label in form.fields.layout.choices %}
            <option value="{{ value }}">{{ label }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="col-12">
        <label class="form-label">Description</label>
        <textarea name="description" class="form-control" rows="3"></textarea>
      </div>

      <div class="col-12">
        <label class="form-label">Upload images (at least 1)</label>
        <input type="file" name="image1" class="form-control mb-2" required>
        <div id="extra-images-container"></div>
        <button type="button" id="addImageBtn" class="btn btn-secondary mt-2">+ Add another image</button>
      </div>

      <div class="col-12">
        <button type="submit" id="finishBtn" class="btn btn-primary" disabled>Submit Booking</button>
      </div>
  </form>

  <!-- Preview -->
  <hr>
  <h3>Preview</h3>
  <div id="preview-container" class="border rounded p-3" style="height:70vh; width:100%; overflow:hidden;">
      <div id="preview-inner" class="d-flex h-100">
          <div id="preview-images" class="d-flex flex-column me-3"></div>
          <div>
              <h4 id="preview-title"></h4>
              <p id="preview-description"></p>
          </div>
      </div>
  </div>

  <script>
    const rentalStart = "{{ request.GET.rental_start }}";
    const rentalEnd = "{{ request.GET.rental_end }}";
  </script>
  <script src="{% static 'js/booking_stage2.js' %}"></script>
</body>
</html>
