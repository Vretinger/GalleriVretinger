{% extends "base.html" %}
{% load humanize i18n %}

{% block content %}
<div class="container py-5" style="min-height: 90vh;">
  <h2 class="mb-4 text-center">ðŸŽ¨ {% trans "Art Gallery" %}</h2>

  <div class="gallery-columns">
    {% for art in artworks %}
      <div class="gallery-item">
        <img src="{{ art.url }}" alt="{{ art.title }}" loading="lazy"
             data-bs-toggle="modal" data-bs-target="#galleryModal"
             data-bs-slide-to="{{ forloop.counter0 }}">
        <div class="gallery-info text-center mt-2">
          <h5>{{ art.title }}</h5>
          <p><strong>{{ art.price|intcomma }} kr</strong></p>
        </div>
      </div>
    {% empty %}
      <p class="text-center">{% trans "No artworks available right now." %}</p>
    {% endfor %}
  </div>
</div>

<!-- Modal + Carousel -->
<div class="modal fade" id="galleryModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content bg-transparent border-0">
      <div class="modal-body p-0 position-relative">
        <button type="button" class="btn-close position-absolute top-0 end-0 m-3" data-bs-dismiss="modal" aria-label="Close"></button>

        <div id="galleryCarousel" class="carousel slide" data-bs-ride="false" data-bs-touch="true">
          <div class="carousel-inner">
            {% for art in artworks %}
            <div class="carousel-item {% if forloop.first %}active{% endif %}">
              <img data-src="{{ art.url }}" class="d-block w-100 lazyload" alt="{{ art.title }}">
              <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded p-2">
                <h5>{{ art.title }}</h5>
                <p><strong>{{ art.price|intcomma }} kr</strong></p>
              </div>
            </div>
            {% endfor %}
          </div>

          <button class="carousel-control-prev" type="button" data-bs-target="#galleryCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">{% trans "Previous" %}</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#galleryCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">{% trans "Next" %}</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Styles -->
<style>
.gallery-columns {
  column-count: 3;
  column-gap: 1rem;
}

.gallery-item {
  display: inline-block;
  width: 100%;
  margin-bottom: 1rem;
  cursor: pointer;
}

.gallery-item img {
  width: 100%;
  display: block;
  border-radius: 6px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  transition: transform 0.3s;
}

.gallery-item img:hover {
  transform: scale(1.03);
}

.gallery-info h5,
.gallery-info p {
  margin: 0;
}

/* Responsive */
@media (max-width: 992px) { .gallery-columns { column-count: 2; } }
@media (max-width: 576px) { .gallery-columns { column-count: 1; } }
</style>

<!-- Scripts -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  const galleryItems = document.querySelectorAll('.gallery-item img');
  const carousel = document.getElementById('galleryCarousel');

  galleryItems.forEach((img, index) => {
    img.addEventListener('click', () => {
      const bsCarousel = bootstrap.Carousel.getInstance(carousel) || new bootstrap.Carousel(carousel);
      bsCarousel.to(index);
    });
  });

  // Lazy-load images inside carousel
  const lazyImages = document.querySelectorAll('.lazyload');
  const observer = new IntersectionObserver((entries, obs) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const img = entry.target;
        img.src = img.dataset.src;
        img.classList.remove('lazyload');
        obs.unobserve(img);
      }
    });
  });

  lazyImages.forEach(img => observer.observe(img));

  // Swipe support for mobile
  let startX = 0;
  let endX = 0;
  carousel.addEventListener('touchstart', e => startX = e.changedTouches[0].screenX);
  carousel.addEventListener('touchend', e => {
    endX = e.changedTouches[0].screenX;
    if (startX - endX > 50) { bootstrap.Carousel.getInstance(carousel).next(); }
    if (endX - startX > 50) { bootstrap.Carousel.getInstance(carousel).prev(); }
  });
});
</script>
{% endblock %}
